import{as as te,at as C,ae as w,r as J,au as z,c as V,A as P,av as D,G as Y,aw as ae,ax as h,ay as Z,az as R,aA as g,aB as S,aC as I,aD as E,aE as Q,aF as K,ag as W,aG as F,aH as H,aI as ne}from"./bIp8vrNC.js";const ce=te("/images/map-marker.svg"),$=e=>e instanceof Date,le=e=>Object.keys(e).length===0,G=e=>e!=null&&typeof e=="object",X=(e,...n)=>Object.prototype.hasOwnProperty.call(e,...n),k=e=>G(e)&&le(e),ie=()=>Object.create(null),B=(e,n)=>{if(e===n)return{};if(!G(e)||!G(n))return n;const l=Object.keys(e).reduce((t,a)=>(X(n,a)||(t[a]=void 0),t),ie());return $(e)||$(n)?e.valueOf()==n.valueOf()?{}:n:Object.keys(n).reduce((t,a)=>{if(!X(e,a))return t[a]=n[a],t;const i=B(e[a],n[a]);return k(i)&&!$(i)&&(k(e[a])||!k(n[a]))||(t[a]=i),t},l)};function U(){W()||g({text:"injectMap must be only called on runtime.",isInternal:!0});const e=I("map");return(!e||!H(e))&&g({text:"Was not able to inject valid map in injectMap.",isInternal:!0}),e}function ue(){W()||g({text:"injectLayers must be only called on runtime.",isInternal:!0});const e=I("layers");return(!e||!H(e))&&g({text:"Was not able to inject valid layers in injectLayers.",isInternal:!0}),e}async function se({timeoutCallback:e,waitDuration:n}={}){if(typeof window>"u"&&g({text:"waitTillYmapInit cannot be called on SSR.",isInternal:!0}),!(typeof ymaps3<"u"))return new Promise((l,t)=>{if(typeof ymaps3>"u"){let a;n=typeof n<"u"?n:h.settings.value.mapsScriptWaitDuration,n!==!1&&(a=setTimeout(()=>{e==null||e(a,!0),t(new h.YandexMapException("Was not able to wait for map initialization in waitTillYmapInit. Ensure that map was initialized. You can change this behavior by using mapsScriptWaitDuration."))},typeof n=="number"?n:5e3),e==null||e(a,!1)),Y(h.isLoaded,()=>{a&&(clearTimeout(a),e==null||e(a,!0)),h.loadStatus.value==="loaded"?l():t(h.loadError)},{immediate:!0})}else l()})}async function ee({map:e,timeoutCallback:n,waitDuration:l}={}){!e&&!W()&&g({text:"onMapInit must be only called on runtime.",isInternal:!0}),typeof window>"u"&&g({text:"waitTillMapInit cannot be called on SSR.",isInternal:!0});const t=e||U();if(!t.value)return new Promise((a,i)=>{let d;l=typeof l<"u"?l:h.settings.value.mapsRenderWaitDuration,l!==!1&&(d=setTimeout(()=>{n==null||n(d,!0),i(new h.YandexMapException("Was not able to wait for map initialization in waitTillMapInit. You can change this behavior by using mapsRenderWaitDuration."))},typeof l=="number"?l:5e3),n==null||n(d,!1));let c;c=Y(t,()=>{t.value&&(c==null||c(),d&&(clearTimeout(d),n==null||n(d,!0)),a())},{immediate:!0})})}function oe({children:e,isMercator:n,root:l}){var t;l||g({text:"Failed to execute deleteMapChild due to destroyed root",isInternal:!0}),e&&!n?typeof(l==null?void 0:l.value)=="object"&&Array.isArray(l.value)?l.value=l.value.filter(a=>a!==e):(t=l.value)==null||t.removeChild(e):l.value&&e&&n&&"update"in l.value&&l.value.update({projection:void 0})}const pe=C({name:"YandexMap",props:{modelValue:{type:Object,default:null},value:{type:Object,default:null},tag:{type:String,default:"div"},width:{type:String,default:"100%"},height:{type:String,default:"100%"},zIndex:{type:Number,default:0},settings:{type:Object,required:!0},readonlySettings:{type:Boolean,default:!1},realSettingsLocation:{type:Boolean,default:!1},layers:{type:Array,default:()=>[]},cursorGrab:{type:Boolean,default:!1}},emits:{input(e){return!e||typeof ymaps3>"u"||e instanceof ymaps3.YMap},"update:modelValue"(e){return!e||typeof ymaps3>"u"||e instanceof ymaps3.YMap}},slots:Object,setup(e,{slots:n,emit:l}){const t=w(null),a=w(null),i=w([]),d=w(null),c=w(null),v=w(!1),o=J(0);z("map",t),z("layers",i),z("projection",d),z("needsToHold",o),l("input",t.value),l("update:modelValue",t.value);const y=V(()=>({...e.settings,projection:void 0})),m=async()=>{e.settings.location||g({text:"You must specify location in YandexMap settings"}),t.value&&t.value.destroy();const u=c.value;if(!u)return;const s=y.value;d.value&&(s.projection=d.value),t.value=new ymaps3.YMap(u,s,[...i.value,...e.layers]),l("input",t.value),l("update:modelValue",t.value)};return P(async()=>{let u,s,b=null;D(()=>{b&&clearTimeout(b)});const _=()=>{s==null||s();let r=F(y);s=Y(y,p=>{var f;if(!t.value)return;const x=F(p);e.realSettingsLocation&&x.location&&("center"in x.location&&"center"in r.location?r.location.center=t.value.center:"bounds"in x.location&&"bounds"in r.location&&(r.location.bounds=t.value.bounds),"zoom"in x.location&&"zoom"in r.location&&(r.location.zoom=t.value.zoom));const j=Object.keys(B(r,x));if(j.length===0)return;const O={...x};for(const T in O)j.includes(T)||delete O[T];r=x,(f=t.value)==null||f.update(O)},{deep:!0})};e.readonlySettings||_(),Y(()=>e.readonlySettings,r=>{r?_():s==null||s()}),Y(()=>e.cursorGrab,async r=>{await ee({map:t,timeoutCallback:(p,f)=>{f?b=null:b=p}}).catch(()=>{}),t.value&&(r?(u=new ymaps3.YMapListener({onActionStart:p=>{var f;p.type==="drag"&&e.cursorGrab&&((f=a.value)==null||f.classList.add("__ymap--grabbing"))},onActionEnd:p=>{var f;p.type==="drag"&&((f=a.value)==null||f.classList.remove("__ymap--grabbing"))}}),t.value.addChild(u)):u&&t.value.removeChild(u))},{immediate:!0});const M=r=>{var p;const f=r.target;!f||!("classList"in f)||(f.classList.contains("ymaps3x0--button")||(p=f.closest)!=null&&p.call(f,".ymaps3x0--button"))&&r.preventDefault()};if(Y(c,r=>{r&&(r.removeEventListener("click",M,{capture:!0}),r.addEventListener("click",M,{capture:!0}))},{immediate:!0}),await ae(),!h.isLoaded.value){if(h.settings.value.initializeOn==="onComponentMount")try{await Z()}catch(r){console.error("An error occured while initializing Yandex Map with onComponentMount setting"),console.error(r);return}else(h.loadStatus.value==="loading"||h.settings.value.initializeOn==="onPluginInit")&&(h.settings.value.initializeOn==="onPluginInit"&&h.loadStatus.value!=="loading"&&await R(),await Z());h.isLoaded.value||g({text:"You have set up <yandex-map> component without initializing Yandex maps. Please check initializeOn setting or call initYmaps manually before registering this component."})}v.value=!0,await R(),o.value&&await new Promise(r=>Y(o,()=>{o.value||r()},{immediate:!0})),await m()}),D(()=>{t.value=null,l("input",t.value),l("update:modelValue",t.value)}),()=>{var u;const s={class:["__ymap",{"__ymap--grab":e.cursorGrab}],ref:a,style:{width:e.width,height:e.height,"z-index":e.zIndex.toString()}},b=S("div",{class:"__ymap_container",ref:c}),_={class:"__ymap_slots",style:{display:"none"}};return v.value?S(e.tag,s,[b,S("div",_,(u=n.default)==null?void 0:u.call(n,{}))]):S(e.tag,s,[b,S("div",_)])}}});async function L({returnOnly:e,willDeleteByHand:n,strictMapRoot:l,requiredImport:t,createFunction:a,settings:i,settingsUpdateIgnoreKeys:d,isLayer:c,isMercator:v,isMapRoot:o,mapRootRef:y,duplicateInit:m}){W()||g({text:"setupMapChildren must be only called on runtime.",isInternal:!0});const u=w(),s=I("mapRoot",null),b=I("mapRootInitPromises",null);let _;const M=U(),r=ue();let p=null;const f=(j,O)=>{p||(p=new Set),O?p.delete(j):p.add(j)};if(o&&!m&&(z("mapRoot",y||u),_=w([]),z("mapRootInitPromises",_)),!e&&!n&&D(()=>{u.value&&oe({children:u.value,isMercator:v,root:s!=null&&s.value?s:M}),p!=null&&p.size&&(p.forEach(j=>clearTimeout(j)),p.clear())}),i){let j=F(i);Y(i,O=>{if(!O)return;const T=Object.keys(B(j,O));if(T.length===0)return;const A=F(O);for(const N in A)T.includes(N)||delete A[N];const q=d&&(H(d)?d.value:d);q&&ne(A,q),Object.keys(A).length!==0&&(j=F(O),u.value&&"update"in u.value&&u.value.update(A))},{deep:!0})}!c&&!v?(await ee({timeoutCallback:f}),M.value||g({text:"map is undefined in setupMapChildren. Please verify that Yandex Maps were initialized successfully and you only use components inside <yandex-map>."})):await se({timeoutCallback:f}),l&&(s!=null&&s.value||await R(),s!=null&&s.value||g({text:"mapRoot is undefined in setupMapChildren. Please verify that you are using component inside it's root: for example, don't use Controls outside <yandex-map-controls>."})),o&&(await R(),await Promise.all((_==null?void 0:_.value)||[]));let x;if(t){const j=t();b!=null&&b.value&&b.value.push(Promise.resolve(j)),x=await j}return u.value=a(x),!e&&M.value&&!v?(b!=null&&b.value&&(await Promise.all(b.value),t||await R()),typeof(s==null?void 0:s.value)=="object"&&Array.isArray(s.value)?s.value=[...s.value,u.value]:((s==null?void 0:s.value)||M.value).addChild(u.value)):c?r.value.push(u.value):v&&M.value&&M.value.update({projection:u.value}),u.value}const fe=C({name:"YandexMapDefaultFeaturesLayer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},slots:Object,setup(e,{slots:n,emit:l}){const t=I("needsToHold");t.value++;let a;return P(async()=>{a=await L({createFunction:()=>new ymaps3.YMapDefaultFeaturesLayer(e.settings||{}),settings:V(()=>e.settings),isLayer:!0}),l("input",a),l("update:modelValue",a),t.value--}),()=>{var i;return E((i=n.default)==null?void 0:i.call(n,{}))}}}),me=C({name:"YandexMapDefaultSchemeLayer",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},slots:Object,emits:{input(e){return!0},"update:modelValue"(e){return!0},hold(e){return!0}},setup(e,{slots:n,emit:l}){const t=I("needsToHold");t.value++;let a;return P(async()=>{a=await L({createFunction:()=>new ymaps3.YMapDefaultSchemeLayer(e.settings||{}),settings:V(()=>e.settings),isLayer:!0}),l("input",a),l("update:modelValue",a),t.value--}),()=>{var i;return(i=n.default)==null?void 0:i.call(n,{})}}});function re({position:e,containerAttrs:n,wrapperAttrs:l,zeroSizes:t}){const a={class:["__ymap-marker"],style:{}},i={class:["__ymap-marker_wrapper"],style:{}},d=e==="default"||e==="default default";if(e&&!d)if(e.startsWith("translate"))i.style.transform=e;else{let v=0,o=0;const y=e.split(" ");for(let m=0;m<y.length;m++){let u=0;const s=y[m];switch(s){case"top":case"left":u=-100;break;case"top-center":case"left-center":u=-50;break;case"bottom":case"right":u=100;break;case"bottom-center":case"right-center":u=50;break;default:u=0}s.startsWith("left")||s.startsWith("right")?v=u:o=u}i.style.transform="translate(".concat(v,"%, ").concat(o,"%)")}(t===!0||t!==!1&&e&&!d)&&(a.style.width="0",a.style.height="0",i.style.transform&&(i.style.width="fit-content"));const c={root:{...n!=null?n:{}},children:{...l!=null?l:{}}};for(const[v,o]of Object.entries(c)){const y=v==="root"?a:i;o.class&&(Array.isArray(o.class)||(o.class=[o.class]),o.class=[...y.class,...o.class]),o!=null&&o.style&&(typeof o.style!="object"||Array.isArray(o.style)?console.warn("Style property was given in ".concat(v," of marker, but it is not an object. Style of this prop can only be an object, therefore it was ignored.")):o.style={...y.style,...o.style}),Object.assign(y,o)}return{root:a,children:i}}const ve=C({name:"YandexMapMarker",inheritAttrs:!1,props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,required:!0},position:{type:String},containerAttrs:{type:Object,default:()=>({})},wrapperAttrs:{type:Object,default:()=>({})},zeroSizes:{type:Boolean,default:null}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},slots:Object,setup(e,{slots:n,emit:l,attrs:t}){let a;const i=J(null);P(async()=>{e.settings.coordinates||g({text:"You must specify coordinates in YandexMapMarker settings"}),a=await L({settings:V(()=>e.settings),createFunction:()=>new ymaps3.YMapMarker(e.settings,i.value)}),l("input",a),l("update:modelValue",a)}),Y(i,()=>{var c;i.value&&((c=i.value.parentNode)==null||c.removeChild(i.value))});const d=V(()=>re({position:e.position,containerAttrs:e.containerAttrs,wrapperAttrs:e.wrapperAttrs,zeroSizes:e.zeroSizes}));return()=>{var c;return Q([S("div",{...d.value.root,ref:i,...K(t)},[S("div",{...d.value.children},(c=n.default)==null?void 0:c.call(n,{}))])])}}}),ye=C({name:"YandexMapControls",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,required:!0}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},slots:Object,setup(e,{slots:n,emit:l}){const t=w(null);return P(async()=>{e.settings.position||g({text:"You must specify position in YandexMapControls settings"}),t.value=await L({createFunction:()=>new ymaps3.YMapControls(e.settings),isMapRoot:!0,settings:V(()=>e.settings)}),l("input",t.value),l("update:modelValue",t.value)}),()=>{var a;return t.value?E((a=n.default)==null?void 0:a.call(n,{})):S("div")}}}),ge=C({name:"YandexMapGeolocationControl",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},slots:Object,setup(e,{slots:n,emit:l}){let t;return P(async()=>{t=await L({createFunction:a=>new a.YMapGeolocationControl(e.settings),requiredImport:()=>ymaps3.import("@yandex/ymaps3-controls@0.0.1"),settings:V(()=>e.settings),strictMapRoot:!0}),l("input",t),l("update:modelValue",t)}),()=>{var a;return E((a=n.default)==null?void 0:a.call(n,{}))}}}),be=C({name:"YandexMapZoomControl",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},settings:{type:Object,default:()=>({})}},slots:Object,emits:{input(e){return!0},"update:modelValue"(e){return!0}},setup(e,{slots:n,emit:l}){let t;return P(async()=>{t=await L({createFunction:a=>new a.YMapZoomControl(e.settings),requiredImport:()=>ymaps3.import("@yandex/ymaps3-controls@0.0.1"),settings:V(()=>e.settings),strictMapRoot:!0}),l("input",t),l("update:modelValue",t)}),()=>{var a;return E((a=n.default)==null?void 0:a.call(n,{}))}}}),he=C({name:"YandexMapHint",props:{value:{type:Object,default:null},modelValue:{type:Object,default:null},hintProperty:{type:String,required:!0}},emits:{input(e){return!0},"update:modelValue"(e){return!0}},slots:Object,setup(e,{slots:n,emit:l,attrs:t}){let a;const i=w(null),d=w("");return P(async()=>{await L({createFunction:({YMapHint:c,YMapHintContext:v})=>{a=new c({hint:y=>{var m;return(m=y==null?void 0:y.properties)==null?void 0:m[e.hintProperty]}});class o extends ymaps3.YMapEntity{_onAttach(){const m=this;m._element=i.value,m._detachDom=ymaps3.useDomContext(m,m._element,null),m._watchContext(v,()=>{var u;d.value=(u=m._consumeContext(v))==null?void 0:u[e.hintProperty]},{immediate:!0})}_onDetach(){this._detachDom()}}return a.addChild(new o({})),a},requiredImport:()=>ymaps3.import("@yandex/ymaps3-hint@0.0.1")}),l("input",a),l("update:modelValue",a)}),()=>{var c;return Q([S("div",{ref:i,...K(t)},(c=n.default)==null?void 0:c.call(n,{content:d.value}))])}}});export{me as _,fe as a,ye as b,ge as c,be as d,ve as e,he as f,pe as g,ce as h};
