import{d as L}from"./CyvmEBDe.js";import{_ as Q,aS as q,N as z,aq as A,z as b,o as n,a as i,b as a,t as r,d as l,q as u,K as U,T as p,F as g,e as y,C as O,J as k,f as w,g as M,az as F,S as C,c as T,w as I,aT as Y,p as _,aH as B,v as P,Y as V,n as H,y as K,u as G,W as J,D as W}from"./bIp8vrNC.js";import{_ as X}from"./CHXXxOy-.js";import{u as E}from"./B_dvM0pQ.js";import{_ as Z}from"./3W3kE5Jc.js";import{_ as x}from"./Dv4En90A.js";import"./CyCUcgYy.js";const ee={name:"resultsTableRow",props:{item:{type:Object},columns:{type:Object}},data(){return{detail:!1}},computed:{certificate(){return q(this.event.title.toLowerCase()+"_"+z(this.event.date).tz().format("DD.MM.YYYY"))+"_result_"+this.item.id+".pdf"},event(){return this.$parent.$parent.event},counters(){return this.$parent.counters},shareUrl(){return A()+b().path+"?r="+this.item.id}},methods:{toggle(){this.detail||this.$parent.$refs.rowsRef.forEach(e=>{e.detail=!1}),this.detail=!this.detail}}},te=["data-id"],se=["data-content"],ne={class:"place"},ie={class:"all-places"},ae=["data-content"],re={class:"place"},le=["data-content"],oe={class:"sportsman-name"},de={key:0,class:"sportsman-elite"},ue={key:0,class:"hidden-block-wrap"},ce=["href","download"],fe=["href"],me=a("img",{src:x,width:"30",alt:""},null,-1),he=[me],ve=["data-content"],ge=["data-content"],ye=["data-content"],ke={key:0},_e={key:1},be={key:2,class:"hidden-block-wrap"},pe={key:0,class:"sport-type-table time"},we={key:0,class:"type"},$e={key:1,class:"time"},Ie={key:2,class:"time"},Re={key:1,class:"sharing"},Ne={class:"header-socials"},Se=["data-content"],Ce=["data-content"],De={class:"place"},Qe={class:"all-places"},Oe=["data-content"],Te={key:0,class:"place"},Ve={key:1,class:"all-places"},Ee={key:2,class:"sharing"},je={class:"header-socials black"};function qe(e,s,t,v,c,d){var f;const h=M,m=Z;return n(),i("tr",{onClick:s[1]||(s[1]=(...o)=>d.toggle&&d.toggle(...o)),class:k({active:c.detail}),"data-id":t.item.id},[t.item.status==="Q"?(n(),i("td",{key:0,"data-content":e.$t("events.result.table.position")},[a("span",ne,r(t.item.rank.abs),1),l(),a("span",ie,r(e.$t("events.result.of"))+" "+r(d.counters.members),1)],8,se)):(n(),i("td",{key:1,"data-content":e.$t("events.result.table.position")},[a("span",re,r(t.item.status),1)],8,ae)),l(),a("td",{"data-type":"name","data-content":e.$t("events.result.table.name")},[a("div",oe,[l(r(t.item.name)+" ",1),t.item.elite?(n(),i("span",de,r(e.$t("events.result.elite")),1)):u("",!0)]),l(),c.detail?(n(),i("div",ue,[a("div",{class:"old_event-image",style:U({backgroundImage:"url("+(t.item.photo?t.item.photo:t.item.gender==="F"?"/images/woman.svg":"/images/man.svg")+")"})},null,4),l(),d.event.type&&[508,14,13].indexOf(d.event.type.id)===-1?(n(),i("a",{key:0,onClick:s[0]||(s[0]=p(()=>{},["stop"])),href:"/local/tools/cerificate.php?id="+t.item.id+"&lang="+e.$i18n.locale,download:d.certificate,class:"btn btn-primary btn-black btn-xs-size"},r(e.$t("events.result.download_certificate")),9,ce)):u("",!0),l(),t.item.strava_id?(n(),i("a",{key:1,href:"https://www.strava.com/athletes/"+t.item.strava_id,target:"_blank",title:"Профиль на STRAVA"},he,8,fe)):u("",!0)])):u("",!0)],8,le),l(),a("td",{"data-content":e.$t("events.result.table.number")},[a("strong",null,r(t.item.number),1)],8,ve),l(),t.columns.rank_category?(n(),i("td",{key:2,"data-content":e.$t("events.result.table.category")},r(((f=e.$tm("events.result.filter.groups")[t.item.category])==null?void 0:f.source)||t.item.category),9,ge)):u("",!0),l(),a("td",{"data-content":e.$t("events.result.table.result")},[t.item.status==="Q"||t.item.status==="DSQ"||t.item.status==="NC"?(n(),i(g,{key:0},[t.item.result>1e4?(n(),i("span",ke,r(e.$formatTimeString(t.item.result)),1)):t.item.result>0?(n(),i("span",_e,r(e.$formatNumber(t.item.result,3,","," "))+" "+r(e.$t("metric.km")),1)):u("",!0),l(),c.detail?(n(),i("div",be,[(n(!0),i(g,null,y(t.item.result_data,o=>(n(),i(g,null,[o.time?(n(),i("div",pe,[["swim","bike","run"].indexOf(o.stage)>=0?(n(),O(h,{key:0,class:"gray stage-icon",name:o.stage},null,8,["name"])):(n(),i("div",{key:1,class:k(["type",{"type-text":o.distance}])},r(e.$capitalizeString(e.$te("events.result.stage."+o.stage)?e.$t("events.result.stage."+o.stage):o.stage)),3)),l(),a("div",null,[o.distance?(n(),i("div",we,r(o.distance)+" "+r(o.time>1e4?e.$t("metric.km"):e.$t("metric.min")),1)):u("",!0),l(),o.time>1e4?(n(),i("div",$e,r(e.$formatTimeString(o.time)),1)):(n(),i("div",Ie,r(e.$formatNumber(o.time,3,","," "))+" "+r(e.$t("metric.km")),1))])])):u("",!0)],64))),256))])):u("",!0)],64)):u("",!0),l(),c.detail&&t.item.status==="Q"&&!t.columns.rank_category?(n(),i("div",Re,[a("span",null,r(e.$t("events.result.share")),1),l(),a("div",Ne,[w(m,{url:d.shareUrl,text:e.$t("events.result.share_text",{race:d.event.title,time:t.item.result>1e4?e.$formatTimeString(this.item.result):e.$formatNumber(this.item.result,3,","," ")+" "+e.$t("metric.km")})},null,8,["url","text"])])])):u("",!0)],8,ye),l(),t.columns.points?(n(),i("td",{key:3,"data-content":e.$t("events.result.table.points")},r(t.item.points),9,Se)):u("",!0),l(),t.columns.rank_gender?(n(),i("td",{key:4,"data-content":e.$t("events.result.table.position")+" "+e.$t("events.result.table.position_gender")},[t.item.status==="Q"?(n(),i(g,{key:0},[a("span",De,r(t.item.rank.gender),1),l(),a("span",Qe,r(e.$t("events.result.of"))+" "+r(d.counters.gender[t.item.gender]),1)],64)):u("",!0)],8,Ce)):u("",!0),l(),t.columns.rank_category?(n(),i("td",{key:5,"data-content":e.$t("events.result.table.position")+" "+e.$t("events.result.table.position_cat")},[t.item.status==="Q"?(n(),i(g,{key:0},[t.item.rank.category>0?(n(),i("span",Te,r(t.item.rank.category),1)):u("",!0),l(),t.item.rank.category>0?(n(),i("span",Ve,r(e.$t("events.result.of"))+" "+r(d.counters.category[t.item.category]),1)):u("",!0),l(),c.detail?(n(),i("div",Ee,[a("span",null,r(e.$t("events.result.share")),1),l(),a("div",je,[w(m,{url:d.shareUrl,text:e.$t("events.result.share_text",{race:d.event.title,time:t.item.result>1e4?e.$formatTimeString(this.item.result):e.$formatNumber(this.item.result,3,","," ")+" "+e.$t("metric.km")})},null,8,["url","text"])])])):u("",!0)],64)):u("",!0)],8,Oe)):u("",!0)],10,te)}const Fe=Q(ee,[["render",qe]]),S=25,Le={name:"resultsRable",props:{items:{type:Array,default:()=>[]},status:{type:String,default:"Q"},columns:{type:Object},offer:{type:Object},counters:{type:Object}},components:{ResultRow:Fe},data(){return{sort:{field:this.status==="Q"?"rank_abs":"",by:"asc"},page:1}},computed:{sorted(){let e=this.items.filter(s=>s.status===this.status);return this.status!=="Q"?e:e.sort((s,t)=>this.sort.field==="rank_abs"?s.rank.abs>t.rank.abs&&this.sort.by==="asc"||s.rank.abs<t.rank.abs&&this.sort.by==="desc"?1:-1:this.sort.field==="rank_gender"?s.rank.gender>t.rank.gender&&this.sort.by==="asc"||s.rank.gender<t.rank.gender&&this.sort.by==="desc"?1:-1:this.sort.field==="rank_category"?s.rank.category>t.rank.category&&this.sort.by==="asc"||s.rank.category<t.rank.category&&this.sort.by==="desc"?1:-1:0)},sliced(){return this.sorted.slice((this.page-1)*S,this.page*S)}},watch:{items(){if(typeof b().query.r<"u"){const e=parseInt(b().query.r||0);let s=this.sorted.findIndex(t=>t.id===e);s>=0&&(this.page=Math.floor(s/S)+1,delete b().query.r,F(()=>{this.$refs.rowsRef.forEach(t=>{t.item.id===e&&(t.detail=!0,setTimeout(()=>{E(t.$el)},250))})}))}}},methods:{sorting(e){if(this.status!=="Q")return;let s=this.sort.field;this.sort.field=e,this.sort.by==="asc"?this.sort.by="desc":this.sort.by="asc",this.sort.field!==s&&(this.sort.by="asc"),this.page=1},paginate(e){this.page=e,E(this.$el)}}},ze={key:0,class:"table-default old_event-table"},Ae={key:0,class:"faq-subhead"},Ue={class:"table-head-default"},Me={class:"table-head-default"},Ye={key:0},Be={class:"table-head-default"},Pe={class:"table-head-default"},He={key:1},Ke={class:"table-head-default"},Ge={key:2},Je={class:"old_event-hide"},We={key:3},Xe={class:"old_event-hide"};function Ze(e,s,t,v,c,d){const h=C("ResultRow"),m=X;return d.sorted.length>0?(n(),i("div",ze,[t.status!=="Q"?(n(),i("div",Ae,r(e.$t("events.result.groups."+t.status))+" ("+r(t.status)+")\n		",1)):u("",!0),l(),a("table",null,[a("thead",null,[a("tr",null,[a("th",null,[a("div",{class:k(["table-head-default",{"table-filter-btn":c.sort.field==="rank_abs",asc:c.sort.by==="asc",desc:c.sort.by==="desc"}]),onClick:s[0]||(s[0]=p(f=>d.sorting("rank_abs"),["prevent"]))},r(e.$t("events.result.table.position")),3)]),l(),a("th",null,[a("div",Ue,r(e.$t("events.result.table."+(t.offer.type_id===2?"team":"name"))),1)]),l(),a("th",null,[a("div",Me,r(e.$t("events.result.table.number")),1)]),l(),t.columns.rank_category?(n(),i("th",Ye,[a("div",Be,r(e.$t("events.result.table.category")),1)])):u("",!0),l(),a("th",null,[a("div",Pe,r(e.$t("events.result.table.result")),1)]),l(),t.columns.points?(n(),i("th",He,[a("div",Ke,r(e.$t("events.result.table.points")),1)])):u("",!0),l(),t.columns.rank_gender?(n(),i("th",Ge,[a("div",{class:k(["table-head-default",{"table-filter-btn":c.sort.field==="rank_gender",asc:c.sort.by==="asc",desc:c.sort.by==="desc"}]),onClick:s[1]||(s[1]=p(f=>d.sorting("rank_gender"),["prevent"]))},[a("span",Je,r(e.$t("events.result.table.position")),1),l(" "+r(e.$t("events.result.table.position_gender")),1)],2)])):u("",!0),l(),t.columns.rank_category?(n(),i("th",We,[a("div",{class:k(["table-head-default",{"table-filter-btn":c.sort.field==="rank_category",asc:c.sort.by==="asc",desc:c.sort.by==="desc"}]),onClick:s[2]||(s[2]=p(f=>d.sorting("rank_category"),["prevent"]))},[a("span",Xe,r(e.$t("events.result.table.position")),1),l(" "+r(e.$t("events.result.table.position_cat")),1)],2)])):u("",!0)])]),l(),a("tbody",null,[(n(!0),i(g,null,y(d.sliced,f=>(n(),O(h,{key:f.id,item:f,status:t.status,columns:t.columns,ref_for:!0,ref:"rowsRef"},null,8,["item","status","columns"]))),128))])]),l(),w(m,{data:{total:d.sorted.length,limit:25,page:c.page},onChange:d.paginate},null,8,["data","onChange"])])):u("",!0)}const xe=Q(Le,[["render",Ze]]),et={class:"filter_result"},tt={class:"old_event-head"},st={key:0,class:"super-radio event-table"},nt=["id","value"],it=["for"],at={class:"small-search"},rt={class:"search-wrap"},lt=["placeholder"],ot=a("button",{class:"search-btn"},[a("i",{class:"icon icon-search"})],-1),dt={key:1,class:"select-wrap"},ut={value:""},ct=["value"],ft=a("div",{class:"arrow-down"},[a("i",{class:"icon icon-arrow-down"})],-1),mt={key:2,class:"select-wrap"},ht={value:""},vt=["value"],gt=a("div",{class:"arrow-down"},[a("i",{class:"icon icon-arrow-down"})],-1),yt={__name:"Filter",props:{filters:Object,filter:Object,offers:Array,offerId:Number},emits:["update:offerId"],setup(e,{emit:s}){const t=e,v=s,c=T({get(){return t.filter},set(h){v("update:filter",h)}}),d=T({get(){return t.offerId},set(h){v("update:offerId",h)}});return(h,m)=>{const f=K;return n(),i("div",et,[a("div",tt,[e.offers.length>1?(n(),i("div",st,[(n(!0),i(g,null,y(e.offers,o=>I((n(),i("input",{class:"toggle-input","onUpdate:modelValue":m[0]||(m[0]=$=>B(d)?d.value=$:null),type:"radio",id:"offer_"+o.id,value:o.id},null,8,nt)),[[Y,_(d)]])),256)),l(),a("div",{class:k({labels:e.offers.length>1})},[(n(!0),i(g,null,y(e.offers,o=>(n(),i("label",{for:"offer_"+o.id},r(h.$t("race_types."+o.type)),9,it))),256))],2)])):u("",!0),l(),a("div",at,[a("div",rt,[I(a("input",{type:"search",placeholder:h.$t("events.result.filter.name"),"onUpdate:modelValue":m[1]||(m[1]=o=>_(c).name=o)},null,8,lt),[[P,_(c).name]]),l(),ot])]),l(),e.filters.category&&e.filters.category.length?(n(),i("div",dt,[I(a("select",{"onUpdate:modelValue":m[2]||(m[2]=o=>_(c).category=o),class:"full-width",tabindex:"1"},[a("option",ut,r(h.$t("events.result.filter.category")),1),l(),(n(!0),i(g,null,y(e.filters.category,o=>{var $;return n(),i("option",{value:o.title},r((($=h.$tm("events.result.filter.groups")[o.title])==null?void 0:$.source)||o.title),9,ct)}),256))],512),[[V,_(c).category]]),l(),ft])):u("",!0),l(),e.filters.gender&&e.filters.gender?(n(),i("div",mt,[I(a("select",{"onUpdate:modelValue":m[3]||(m[3]=o=>_(c).gender=o),class:"full-width",tabindex:"1"},[a("option",ht,r(h.$t("events.result.filter.gender")),1),l(),(n(!0),i(g,null,y(e.filters.gender,o=>(n(),i("option",{value:o.title},r(h.$t("genders_full."+o.title)),9,vt))),256))],512),[[V,_(c).gender]]),l(),gt])):u("",!0),l(),Object.keys(e.filters).length?(n(),O(f,{key:3,to:"/news/novye-usloviya-popadaniya-v-kategoriyu-elita/",class:"elite-help"},{default:H(()=>[l(r(h.$t("events.result.elite_link")),1)]),_:1})):u("",!0)])])}}};var N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"EventResultsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"Objects"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"results"},name:{kind:"Name",value:"Results"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],directives:[]}]}}],loc:{start:0,end:105}};N.loc.source={body:"query EventResultsQuery ($id: Int!, $filter: Objects) {\n    results: Results (id: $id, filter: $filter)\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function R(e,s){if(e.kind==="FragmentSpread")s.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&s.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(v){R(v,s)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(v){R(v,s)}),e.definitions&&e.definitions.forEach(function(v){R(v,s)})}var D={};(function(){N.definitions.forEach(function(s){if(s.name){var t=new Set;R(s,t),D[s.name.value]=t}})})();function j(e,s){for(var t=0;t<e.definitions.length;t++){var v=e.definitions[t];if(v.name&&v.name.value==s)return v}}function kt(e,s){var t={kind:e.kind,definitions:[j(e,s)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var v=D[s]||new Set,c=new Set,d=new Set;for(v.forEach(function(m){d.add(m)});d.size>0;){var h=d;d=new Set,h.forEach(function(m){if(!c.has(m)){c.add(m);var f=D[m]||new Set;f.forEach(function(o){d.add(o)})}})}return c.forEach(function(m){var f=j(e,m);f&&t.definitions.push(f)}),t}kt(N,"EventResultsQuery");const _t=L({name:"PageEventResult",props:{event:{type:Object}},components:{ResultTable:xe,ResultFilter:yt},setup(){G({titleTemplate:J().t("events.tabs_seo.result")+" %s"})},data(){return{filter:{name:"",category:"",gender:""},offerId:0,resultId:0,columns:{rank_abs:!0,rank_category:!0,rank_gender:!0,points:!1},itemsData:[],filters:{},results:[],counters:{}}},computed:{offer(){return this.event.offers.find(e=>e.id===this.offerId)},items(){let e=this.itemsData;return this.filter.category!==""&&(e=e.filter(s=>s.category===this.filter.category)),this.filter.gender!==""&&(e=e.filter(s=>s.gender===this.filter.gender)),this.filter.name!==""&&(e=e.filter(s=>{let t=s.number.toLowerCase().indexOf(this.filter.name.toLowerCase())>=0;return t||(t=s.name.toLowerCase().indexOf(this.filter.name.toLowerCase())>=0),t||(t=q(s.name.toLowerCase()).indexOf(this.filter.name.toLowerCase())>=0),t})),e}},watch:{offerId(e,s){s!==0&&(this.resultId=0,this.load())},resultId(e,s){parseInt(e)!==parseInt(s)&&s!==0&&e!==0&&this.load()}},created(){typeof b().query.e<"u"&&!isNaN(parseInt(b().query.e||""))?this.offerId=parseInt(b().query.e||""):this.offerId=this.event.offers.length?this.event.offers[0].id:0},mounted(){F(()=>{this.load()})},methods:{async load(){if(this.offerId)try{const e=await W(N,{id:this.offerId,filter:{result:this.resultId}},"cache-first").then(({results:s})=>s);this.resultId===0&&(this.resultId=e.id),this.itemsData=e.items,this.filters=e.filter,this.counters=e.counters,this.results=e.results,this.updateColumns()}catch(e){console.log(e.message)}},updateColumns(){this.columns.rank_category=this.items.reduce((e,s)=>e+parseInt(s.rank.category),0)>0,this.columns.rank_gender=this.items.reduce((e,s)=>e+parseInt(s.rank.gender),0)>0,this.columns.points=this.items.reduce((e,s)=>e+parseInt(s.points),0)>0,this.filters.category.length<=1&&(this.columns.rank_category=!1),this.filters.gender.length<=1&&(this.columns.rank_gender=!1)}}},"$QlbXAKIz4a"),bt={class:"event-page__result"},pt={key:0,class:"result-page"},wt={key:0,class:"navigation-container"},$t=["onClick"];function It(e,s,t,v,c,d){const h=C("ResultFilter"),m=C("ResultTable");return n(),i("div",bt,[e.offerId>0?(n(),i("div",pt,[w(h,{filter:e.filter,"onUpdate:filter":s[0]||(s[0]=f=>e.filter=f),offerId:e.offerId,"onUpdate:offerId":s[1]||(s[1]=f=>e.offerId=f),offers:e.event.offers,filters:e.filters},null,8,["filter","offerId","offers","filters"]),l(),e.results.length>1?(n(),i("div",wt,[(n(!0),i(g,null,y(e.results,f=>(n(),i("a",{href:"#",onClick:p(o=>e.resultId=f.id,["prevent"]),class:k(["navigation-item",{active:e.resultId===f.id}])},r(f.title),11,$t))),256))])):u("",!0),l(),(n(),i(g,null,y(["Q","NC","DSQ","DNF","DNS"],f=>w(m,{key:f,status:f,items:e.items,offer:e.offer,columns:e.columns,counters:e.counters,class:k({"complete-table":f==="Q"})},null,8,["status","items","offer","columns","counters","class"])),64))])):u("",!0)])}const Tt=Q(_t,[["render",It]]);export{Tt as default};
