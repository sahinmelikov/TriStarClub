import{_ as O}from"./Ctq6v3cF.js";import{_ as Q}from"./vTIBdjwe.js";import{_ as H,o as h,a as k,b as i,d as t,t as o,J as _,O as U,X as q,Q as A,Z as v,a4 as X,a5 as z,$ as J,a6 as Y,D as L,a7 as Z,a0 as j,a8 as K,a1 as W,a9 as x,I as ee,S as G,f,T as ie,w,v as S,C as ne,q as N,n as te,k as ae,a3 as se,aa as oe}from"./bIp8vrNC.js";import{_ as re}from"./CNmUNVPL.js";import{d as le}from"./CyvmEBDe.js";import{u as de}from"./B_dvM0pQ.js";import{_ as ce}from"./B4KS3TuP.js";import{u as R}from"./BqTjkno-.js";import{d as me}from"./TPQ_BZzG.js";import"./CyCUcgYy.js";import"./3Ue6NacK.js";import"./Bo3olcGw.js";const ue={name:"preview",props:{type:{type:String,default:""},price:{type:Number,default:null}},computed:{image(){return"/local/templates/main/assets/images/certificates/"+this.type+"_mini.png"}}},fe=["src"],pe={class:"title"},ve={class:"subtitle"},he={class:"price"},_e=["innerHTML"],ye=i("div",{class:"code"},[t("\n			xxxx-xxxx-xxxx-xxxx\n			"),i("div",{class:"subtitle"},"promocode")],-1),ke=["innerHTML"],ge=["innerHTML"];function $e(e,n,a,s,m,l){var u;return h(),k("div",{class:_(["certificate-img",[a.type]])},[i("img",{src:l.image,alt:""},null,8,fe),t(),i("div",pe,[t(o(e.$t("gift.blank.title"))+" ",1),i("div",ve,o(e.$t("gift.blank.subtitle")),1)]),t(),i("div",he,[t(o((u=a.price)!=null?u:"XXXX")+" ",1),i("div",{class:"subtitle",innerHTML:e.$t("gift.blank.price")},null,8,_e)]),t(),ye,t(),i("div",{class:"hint_1",innerHTML:e.$t("gift.blank.hint")},null,8,ke),t(),i("div",{class:"hint_2",innerHTML:e.$t("gift.blank.hint_2")},null,8,ge)],2)}const be=H(ue,[["render",$e]]);var y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GiftPageQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"price"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"paymentId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"gift"},name:{kind:"Name",value:"Gift"},arguments:[{kind:"Argument",name:{kind:"Name",value:"price"},value:{kind:"Variable",name:{kind:"Name",value:"price"}}},{kind:"Argument",name:{kind:"Name",value:"paymentId"},value:{kind:"Variable",name:{kind:"Name",value:"paymentId"}}}],directives:[]}]}}],loc:{start:0,end:106}};y.loc.source={body:"query GiftPageQuery($price: Int, $paymentId: Int) {\n    gift: Gift(price: $price, paymentId: $paymentId)\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function g(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var a=e.type;a.kind==="NamedType"&&n.add(a.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(s){g(s,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(s){g(s,n)}),e.definitions&&e.definitions.forEach(function(s){g(s,n)})}var V={};(function(){y.definitions.forEach(function(n){if(n.name){var a=new Set;g(n,a),V[n.name.value]=a}})})();function B(e,n){for(var a=0;a<e.definitions.length;a++){var s=e.definitions[a];if(s.name&&s.name.value==n)return s}}function we(e,n){var a={kind:e.kind,definitions:[B(e,n)]};e.hasOwnProperty("loc")&&(a.loc=e.loc);var s=V[n]||new Set,m=new Set,l=new Set;for(s.forEach(function(r){l.add(r)});l.size>0;){var u=l;l=new Set,u.forEach(function(r){if(!m.has(r)){m.add(r);var c=V[r]||new Set;c.forEach(function(p){l.add(p)})}})}return m.forEach(function(r){var c=B(e,r);c&&a.definitions.push(c)}),a}we(y,"GiftPageQuery");var b={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"GiftMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"GiftInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"gift"},name:{kind:"Name",value:"Gift"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"payment"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:125}};b.loc.source={body:"mutation GiftMutation ($data: GiftInput!) {\n    gift: Gift (data: $data) {\n        id\n        payment\n        message\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function $(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var a=e.type;a.kind==="NamedType"&&n.add(a.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(s){$(s,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(s){$(s,n)}),e.definitions&&e.definitions.forEach(function(s){$(s,n)})}var I={};(function(){b.definitions.forEach(function(n){if(n.name){var a=new Set;$(n,a),I[n.name.value]=a}})})();function F(e,n){for(var a=0;a<e.definitions.length;a++){var s=e.definitions[a];if(s.name&&s.name.value==n)return s}}function Se(e,n){var a={kind:e.kind,definitions:[F(e,n)]};e.hasOwnProperty("loc")&&(a.loc=e.loc);var s=I[n]||new Set,m=new Set,l=new Set;for(s.forEach(function(r){l.add(r)});l.size>0;){var u=l;l=new Set,u.forEach(function(r){if(!m.has(r)){m.add(r);var c=I[r]||new Set;c.forEach(function(p){l.add(p)})}})}return m.forEach(function(r){var c=F(e,r);c&&a.definitions.push(c)}),a}Se(b,"GiftMutation");const Ne=oe(re),Ve=le({name:"PageGift",components:{Preview:be,Payments:ce},asyncData:async()=>{let e,n;const a=([e,n]=U(()=>Promise.all([L(y),R().loadPaymentData(),ae().getPageInfo()]).then(([{gift:s}])=>s)),e=await e,n(),e);return{sender:a.sender,image:a.image||"default",calculatedPrice:a.price||0,paymentId:a.payment_id||0}},setup(){return{v$:q({$autoDirty:!0})}},data:()=>({price:null,paymentFromBalance:!1}),computed:{...A(R,["payment"]),totalPrice(){let e=this.calculatedPrice;return(this.paymentFromBalance||this.paymentId===this.payment.internal.id)&&(e-=this.payment.internal.value),Math.max(0,e)}},watch:{price:me(function(){this.update()},300),paymentId(e,n){n<=0||this.update()}},validations:{price:{required:v,between:X(1250,55e3)},sender:{name:{required:v,nameValidator:z},email:{required:v,email:J},phone:{required:v,phoneValidator:Y}},paymentId:{required:v}},methods:{async update(){const e=await L(y,{price:this.price,paymentId:this.paymentId}).then(({gift:n})=>n);this.calculatedPrice=e.price},async send(){if(!await this.v$.$validate()){let e=document.querySelector("form .error");e&&de(e);return}Z();try{const e=await j(b,{data:{price:this.price,sender:this.sender,payment:this.paymentId,payment_from_balance:this.paymentFromBalance}}).then(({gift:n})=>n);K(),W("sertificate"),x(e)}catch(e){ee(e)}}}},"$GSYXo5mw3N"),Ie={class:"content-block white-bg certificate"},De={class:"container"},Pe={class:"row"},Te={class:"col-lg-6"},Me={class:"certificate-form form"},Ee={class:"form-group"},Le=["innerHTML"],Ge=i("div",{class:"form-divider"},null,-1),Re={class:"form-title"},Be={class:"form-group"},Fe={class:"form-group"},He={class:"form-group"},Ce=i("div",{class:"form-divider"},null,-1),Oe={class:"form-title"},Qe={class:"form-group radio-group no-label"},Ue={class:"first-level level"},qe={class:"radio"},Ae=i("input",{type:"radio",id:"type_0",name:"type",value:"1",checked:""},null,-1),Xe=["innerHTML"],ze=i("div",{class:"form-divider"},null,-1),Je={class:"text18"},Ye=i("span",{class:"gray-text"},"*",-1),Ze=i("div",{class:"form-divider"},null,-1),je={key:1,class:"d-lg-none"},Ke=i("div",{class:"form-divider"},null,-1),We={class:"row"},xe={class:"col-6 col-xxs-12"},ei={class:"certificate-price-label black"},ii={class:"text"},ni={class:"price"},ti=i("div",{class:"clearfix"},null,-1),ai={class:"col-6 col-xxs-12"},si={class:"certificate-price-label red"},oi={class:"text"},ri={class:"price"},li=i("div",{class:"clearfix"},null,-1),di=i("div",{class:"form-divider"},null,-1),ci=i("div",{class:"form-divider"},null,-1),mi={class:"form-group no-label text18"},ui=["innerHTML"],fi=i("div",{class:"form-divider"},null,-1),pi={class:"col-lg-6 d-none d-md-block"},vi={key:0,class:"row"},hi={class:"col-6 col-xxs-12"},_i={class:"certificate-price-label black"},yi={class:"text"},ki={class:"price"},gi=i("div",{class:"clearfix"},null,-1),$i={class:"col-6 col-xxs-12"},bi={class:"certificate-price-label red"},wi={class:"text"},Si={class:"price"},Ni=i("div",{class:"clearfix"},null,-1);function Vi(e,n,a,s,m,l){var P,T,M,E;const u=O,r=Q,c=Ne,p=G("Payments"),D=G("Preview"),C=se;return h(),k("section",Ie,[i("div",De,[f(u),t(),f(r),t(),i("div",Pe,[i("div",Te,[i("div",Me,[i("form",{onSubmit:n[6]||(n[6]=ie((...d)=>e.send&&e.send(...d),["prevent"])),action:"",method:"post"},[i("div",Ee,[i("label",null,o(e.$t("gift.price"))+" *",1),t(),i("div",null,[w(i("input",{class:_({error:(P=e.v$.price)==null?void 0:P.$error}),type:"text",name:"price","onUpdate:modelValue":n[0]||(n[0]=d=>e.price=d)},null,2),[[S,e.price,void 0,{number:!0}]]),t(),i("div",{style:{position:"absolute","margin-top":"5px"},innerHTML:e.$t("gift.price_hint")},null,8,Le)])]),t(),Ge,t(),i("h4",Re,o(e.$t("gift.fields.sender"))+" *",1),t(),i("div",Be,[i("label",null,o(e.$t("gift.fields.name")),1),t(),w(i("input",{class:_({error:(T=e.v$.sender)==null?void 0:T.name.$error}),type:"text",name:"sender[name]","onUpdate:modelValue":n[1]||(n[1]=d=>e.sender.name=d)},null,2),[[S,e.sender.name]])]),t(),i("div",Fe,[i("label",null,o(e.$t("gift.fields.email")),1),t(),w(i("input",{class:_({error:(M=e.v$.sender)==null?void 0:M.email.$error}),type:"email",name:"sender[email]","onUpdate:modelValue":n[2]||(n[2]=d=>e.sender.email=d)},null,2),[[S,e.sender.email]])]),t(),i("div",He,[i("label",null,o(e.$t("gift.fields.phone")),1),t(),f(c,{class:_({error:(E=e.v$.sender)==null?void 0:E.phone.$error}),name:"sender[phone]",modelValue:e.sender.phone,"onUpdate:modelValue":n[3]||(n[3]=d=>e.sender.phone=d)},null,8,["class","modelValue"])]),t(),Ce,t(),i("h4",Oe,o(e.$t("gift.type"))+" *",1),t(),i("div",Qe,[i("div",Ue,[i("div",qe,[Ae,t(),i("label",{for:"type_0",innerHTML:e.$t("gift.types.1")},null,8,Xe)])])]),t(),ze,t(),i("div",Je,[Ye,t(" "+o(e.$t("gift.required")),1)]),t(),Ze,t(),e.price?(h(),ne(p,{key:0,price:e.price,modelValue:e.paymentId,"onUpdate:modelValue":n[4]||(n[4]=d=>e.paymentId=d),onPayFromBalance:n[5]||(n[5]=d=>e.paymentFromBalance=d)},null,8,["price","modelValue"])):N("",!0),t(),e.price?(h(),k("div",je,[f(D,{type:e.image,price:e.price},null,8,["type","price"]),t(),Ke,t(),i("div",We,[i("div",xe,[i("div",ei,[i("span",ii,o(e.$t("gift.certificate")),1),t(),i("span",ni,o(e.$formatCurrency(e.price,"RUB")),1),t(),ti])]),t(),i("div",ai,[i("div",si,[i("span",oi,o(e.$t("gift.total")),1),t(),i("span",ri,o(e.$formatCurrency(e.totalPrice,"RUB")),1),t(),li])])]),t(),di,t(),ci])):N("",!0),t(),i("div",mi,[i("div",{class:"checkbox",innerHTML:e.$t("gift.terms")},null,8,ui)]),t(),fi,t(),f(C,{callback:e.send,class:"btn-primary",disabled:!e.price||e.v$.$invalid},{default:te(()=>[t(o(e.$t("gift.buy")),1)]),_:1},8,["callback","disabled"])],32)])]),t(),i("div",pi,[f(D,{type:e.image,price:e.price},null,8,["type","price"]),t(),e.price?(h(),k("div",vi,[i("div",hi,[i("div",_i,[i("span",yi,o(e.$t("gift.certificate")),1),t(),i("span",ki,o(e.$formatCurrency(e.price,"RUB")),1),t(),gi])]),t(),i("div",$i,[i("div",bi,[i("span",wi,o(e.$t("gift.total")),1),t(),i("span",Si,o(e.$formatCurrency(e.totalPrice,"RUB")),1),t(),Ni])])])):N("",!0)])])])])}const Ci=H(Ve,[["render",Vi]]);export{Ci as default};
