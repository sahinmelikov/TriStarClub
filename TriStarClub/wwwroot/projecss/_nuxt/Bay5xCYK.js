import{_ as q}from"./Ctq6v3cF.js";import{_ as z}from"./vTIBdjwe.js";import{_ as Y,o as s,a as o,F as k,b as r,t as n,d as t,q as c,Q as J,V as U,N as T,aJ as N,a2 as F,D as M,S as I,C as f,T as P,n as m,e as O,f as b,J as S,aK as B,aL as H,y as V,z as K,i as Q,l as Z,E as G,A as W,r as X,c as D,u as x,p as u,B as ee,aM as te,k as se}from"./bIp8vrNC.js";import{u as ne}from"./CyCUcgYy.js";import{v as ae}from"./CqiT2kZx.js";import{_ as ie}from"./BYKg1SCn.js";import{_ as re}from"./3W3kE5Jc.js";import{E as oe}from"./aXYSAK1N.js";import{d as le}from"./3Ue6NacK.js";import ce from"./ItgtrmpN.js";import{a as ue,_ as de,d as ve}from"./CWI3wdPG.js";import{d as fe}from"./438wU9fJ.js";import"./BvQgWdB0.js";import"./z1mF-5nA.js";const _e={name:"EventCardOffer",props:{offer:{type:Object}},computed:{isRelay(){return this.offer.type===oe}}},me={class:"block"},he={class:"title"},ge={key:0,class:"price"},ye={key:1,class:"price"},be={key:0,class:"old"},ke={class:"title"},pe={key:0,class:"price"},we={key:1,class:"price"},Ce={key:0,class:"old"},Ee={key:2,class:"credit"};function Te(a,l,e,h,E,_){return s(),o("div",me,[_.isRelay&&e.offer.members_min===e.offer.members_max?(s(),o(k,{key:0},[r("div",he,n(a.$t("race_types."+e.offer.type))+", "+n(a.$t("events.detail.one_member_relay")),1),t(),e.offer.available?e.offer.price?(s(),o("div",ye,[e.offer.price.value!==e.offer.price.original?(s(),o("div",be,n(a.$formatCurrency(e.offer.price.original/e.offer.members_max,e.offer.price.currency)),1)):c("",!0),t(" "+n(a.$formatCurrency(e.offer.price.value/e.offer.members_max,e.offer.price.currency)),1)])):c("",!0):(s(),o("div",ge,n(a.$t("events.status.SOLD_OUT")),1))],64)):(s(),o(k,{key:1},[r("div",ke,n(a.$t("race_types."+e.offer.type)),1),t(),e.offer.available?e.offer.price?(s(),o("div",we,[e.offer.price.value!==e.offer.price.original?(s(),o("div",Ce,n(a.$formatCurrency(e.offer.price.original,e.offer.price.currency)),1)):c("",!0),t(" "+n(a.$formatCurrency(e.offer.price.value,e.offer.price.currency)),1)])):c("",!0):(s(),o("div",pe,n(a.$t("events.status.SOLD_OUT")),1))],64)),t(),e.offer.credit&&e.offer.price.value>=3e3?(s(),o("div",Ee,"(можно оплатить от "+n(e.offer.credit)+"Р/мес.)",1)):c("",!0)])}const $e=Y(_e,[["render",Te]]),Le={name:"EventCard",props:{event:{type:Object},toggle:{type:Boolean,default:!1}},components:{EventCardOffer:$e},computed:{...J(U,["user"]),hasTeamType(){let a=!1;return this.event.offers.length>0&&this.event.offers.forEach(l=>{l.type===2&&(a=!0)}),a},endRegistrationTime(){return this.event.registration_end?T(this.event.registration_end).unix():T(this.event.date).unix()},regTimer(){let a=T().unix();if(this.endRegistrationTime<a)return"";let l=0;return this.endRegistrationTime-a>86400?(l=Math.floor((this.endRegistrationTime-a)/86400),this.$t("events.detail.timer",l)+" "+this.$t("events.detail.timer_day",l)):(l=Math.floor((this.endRegistrationTime-a)/3600),this.$t("events.detail.timer",l)+" "+this.$t("events.detail.timer_hour",l))},inBasket(){return this.user&&this.user.basket&&this.user.basket.indexOf(this.event.id)>-1}},mounted(){this.getCreditInfo()},methods:{authPopup(){N(ce,{class:"is-modal-content white-bg",onLogin:()=>{B(H()("/race/"+this.event.id+"/"))}})},inBasketPopup(){F(this.$t("forms.error"),this.$t("forms.in_basket"))},preRegistration(){N(ue,{event:this.event})},async getCreditInfo(){if(!this.event.offers.length)return;let a=[];this.event.offers.forEach(e=>{a.push(M(le,{price:e.price.value},"cache-first").then(({info:h})=>Math.ceil((h==null?void 0:h.amount)||0)))});const l=await Promise.all(a);this.event.offers.forEach((e,h)=>{e.credit=l[h]})}}},Re={class:"sticky-md-top"},Pe={key:0,class:"old_event-wrap"},De={class:"change-table"},Me={class:"title"},Oe={class:"event-head-info"},Be={class:"date"},Ye={class:"place"},Ae={key:0,class:"short-table"},Ne=r("i",{class:"icon icon-arrow-right"},null,-1),Ie=[Ne],Se={class:"event-item-head"},Ve={class:"title"},je={class:"event-head-info"},qe={class:"date"},ze={class:"place"},Je={key:1,class:"event-card-buttons-reg"},Ue={class:"event-card-buttons-reg"},Fe=["href"],He=["href"],Ke={key:0,class:"event-prices"},Qe={key:3,class:"event-card-buttons-reg"},Ze=["href"],Ge={key:4,class:"event-card-buttons-reg"},We={key:5,class:"event-documents"},Xe=["href"],xe={class:"icon text-icon"},et={class:"event-aside-footer"},tt={class:"sharing"};function st(a,l,e,h,E,_){const i=ie,p=V,y=I("EventCardOffer"),C=re;return s(),o("div",Re,[e.toggle?(s(),o("div",Pe,[r("div",De,[r("div",{class:"event-item-head",onClick:l[0]||(l[0]=d=>a.$emit("toggle"))},[r("div",Me,n(e.event.type?e.event.type.title:e.event.title),1),t(),r("div",Oe,[r("div",Be,n(a.$formatDate(e.event.date,"DD.MM.YYYY")),1),t(),r("div",Ye,n(e.event.city),1)])])])])):c("",!0),t(),e.toggle?c("",!0):(s(),f(i,{key:1,type:"EVENT_DETAIL",count:2})),t(),r("div",{class:S(["event-short-card",{"old-event-aside":!e.event.open}])},[e.toggle?(s(),o("div",Ae,[r("div",{class:"btn-wrap",onClick:l[1]||(l[1]=d=>a.$emit("toggle"))},Ie)])):c("",!0),t(),r("div",Se,[r("div",Ve,n(e.event.type?e.event.type.title:e.event.title),1),t(),r("div",je,[r("div",qe,n(a.$formatDate(e.event.date,"DD.MM.YYYY")),1),t(),r("div",ze,n(e.event.city),1)])]),t(),e.event.pre_registration?(s(),o("div",Je,[e.event.pre_registration?(s(),o("a",{key:0,onClick:l[2]||(l[2]=P((...d)=>_.preRegistration&&_.preRegistration(...d),["prevent"])),href:"",class:"btn btn-white"},n(a.$t("events.preregistration")),1)):c("",!0)])):e.event.open?(s(),o(k,{key:2},[r("div",Ue,[r("h3",null,n(_.regTimer),1),t(),_.inBasket?(s(),o("a",{key:0,onClick:l[3]||(l[3]=P((...d)=>_.inBasketPopup&&_.inBasketPopup(...d),["prevent"])),href:"",class:"btn btn-white"},n(a.$t("events.detail.registration")),1)):a.user?(s(),f(p,{key:2,to:"/race/"+e.event.id+"/",class:"btn btn-default btn-white"},{default:m(()=>[t(n(a.$t("events.detail.registration")),1)]),_:1},8,["to"])):(s(),o("a",{key:1,onClick:l[4]||(l[4]=P((...d)=>_.authPopup&&_.authPopup(...d),["prevent"])),href:"",class:"btn btn-white"},n(a.$t("events.registration")),1)),t(),e.event.button?(s(),o("a",{key:3,href:e.event.button.link,target:"_blank",class:"btn btn-default btn-white"},n(e.event.button.text),9,Fe)):c("",!0),t(),e.event.type&&e.event.type.id!==14&&e.event.type.id!==13&&e.event.type.id!==16023?(s(),f(p,{key:4,to:"/gift/"+e.event.id+"/",class:"btn btn-default btn-white"},{default:m(()=>[t(n(a.$t("events.detail.gift")),1)]),_:1},8,["to"])):c("",!0),t(),e.event.volunteers_url?(s(),o("a",{key:5,href:e.event.volunteers_url,target:"_blank",class:"btn btn-default btn-white"},n(a.$t("events.detail.volunteers")),9,He)):c("",!0)]),t(),e.event.offers.length>0?(s(),o("div",Ke,[(s(!0),o(k,null,O(e.event.offers,d=>(s(),f(y,{key:d.id,offer:d},null,8,["offer"]))),128)),t(),_.hasTeamType?(s(),f(p,{key:0,to:"/searchteam/",class:"btn btn-default btn-white"},{default:m(()=>[t(n(a.$t("events.detail.searchteam")),1)]),_:1})):c("",!0)])):c("",!0)],64)):e.event.registration_url?(s(),o("div",Qe,[r("a",{href:e.event.registration_url,target:"_blank",class:"btn btn-default btn-white"},n(a.$t("events.detail.registration")),9,Ze)])):e.event.status?(s(),o("div",Ge,[r("h3",null,n(a.$te("events.status."+e.event.status)?a.$t("events.status."+e.event.status):e.event.status),1)])):c("",!0),t(),e.event.documents.length?(s(),o("div",We,[(s(!0),o(k,null,O(e.event.documents,d=>(s(),o("a",{href:d.src,target:"_blank",class:"ssylko"},[r("i",xe,n(d.extension),1),t(),r("span",null,n(d.title),1)],8,Xe))),256))])):c("",!0),t(),r("div",et,[r("div",tt,[b(C,{text:e.event.title},null,8,["text"]),t(" "+n(a.$t("events.detail.share")),1)])])],2)])}const nt=Y(Le,[["render",st]]),at={name:"others",props:{items:{type:Array,default:()=>[]}},components:{EventItem:de}},it={key:0,class:"interesting-events black-bg large-double-block"},rt=r("div",{class:"pattern top"},null,-1),ot=r("div",{class:"pattern middle"},null,-1),lt=r("div",{class:"pattern bottom"},null,-1),ct={class:"large-item"},ut={class:"container"},dt={class:"event-list"},vt={class:"row"},ft={class:"col-lg-4 col-6 col-xxs-12"},_t={class:"show-more-container"};function mt(a,l,e,h,E,_){const i=I("EventItem"),p=V;return e.items&&e.items.length?(s(),o("section",it,[rt,t(),ot,t(),lt,t(),r("div",ct,[r("div",ut,[r("h2",null,n(a.$t("events.others")),1),t(),r("div",dt,[r("div",vt,[(s(!0),o(k,null,O(e.items,y=>(s(),o("div",ft,[(s(),f(i,{key:y.id,item:y},null,8,["item"]))]))),256))]),t(),r("div",_t,[b(p,{to:"/event/",class:"btn btn-white"},{default:m(()=>[t(n(a.$t("index.calendar")),1)]),_:1})])])])])])):c("",!0)}const ht=Y(at,[["render",mt]]),gt={class:"content-block white-bg"},yt={class:"container"},bt={class:"navigation-container"},kt={class:"content-block-aside"},At={__name:"[id]",async setup(a){let l,e;const h=K(),{data:E,error:_}=([l,e]=Q(async()=>ne(async()=>{let v=M(ve,{id:h.params.id}),A=M(fe,{limit:6,page:1,sort:{date:"asc"},filter:{">=date":T().tz().format("DD.MM.YYYY"),available:!1,"!code":h.params.id}});const[w,L]=await Promise.all([v,A,se().getPageInfo()]).then(([{event:g},{events:R}])=>[g,R.items]);return w.result>0&&(w.url=w.url.replace("/event/","/results/")),{event:w,others:L}},"$IScKm7ZihL")),l=await l,e(),l);if(_.value)throw Z(_.value);const{event:i,others:p}=G(E.value);i.value.result>0&&!h.path.includes("result")&&B(i.value.url,{redirectCode:301}),i.value.url.includes("http")&&B(i.value.url,{redirectCode:301}),W(()=>{ae(i.value)});const y=X(!0),C=D(()=>i.value.preview.replace(/<\/?[^>]+>/gi,"").replace(/[\n\t\r]/g,"").replace(/&nbsp;/g," ").trim()),d=D(()=>i.value.url.match(/\/results\/(.*?)\//)!==null),$=D(()=>{let v=h.path.match(/\/results\/(.*?)\/(.*?)\//);return v&&v.length>=3?v[2]:d.value&&i.value.tabs.result?"result":"index"});function j(){y.value=!y.value}return x({script:[{innerHTML:JSON.stringify({"@context":"https://schema.org/","@type":"Event",name:i.value.title,description:C.value,startDate:i.value.date,url:i.value.url,image:i.value.image,location:{"@type":"Place",name:i.value.city,address:i.value.city}}),type:"application/ld+json"}],meta:[{hid:"og:description",name:"og:description",content:C.value},{hid:"description",name:"description",content:C.value}]}),(v,A)=>{const w=q,L=z,g=ee,R=te;return s(),o("div",null,[r("section",gt,[r("div",yt,[b(w),t(),b(L),t(),r("div",bt,[d.value?(s(),o(k,{key:0},[u(i).tabs.result?(s(),f(g,{key:0,to:u(i).url,class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.result")),1)]),_:1},8,["to"])):(s(),f(g,{key:1,to:u(i).url,class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.info")),1)]),_:1},8,["to"])),t(),u(i).tabs.result?(s(),f(g,{key:2,to:u(i).url+"about/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.info")),1)]),_:1},8,["to"])):c("",!0)],64)):(s(),o(k,{key:1},[b(g,{to:u(i).url,class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.info")),1)]),_:1},8,["to"]),t(),u(i).tabs.result?(s(),f(g,{key:0,to:u(i).url+"result/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.result")),1)]),_:1},8,["to"])):c("",!0)],64)),t(),u(i).tabs.routes?(s(),f(g,{key:2,to:u(i).url+"routes/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.routes")),1)]),_:1},8,["to"])):c("",!0),t(),u(i).tabs.participants?(s(),f(g,{key:3,to:u(i).url+"participants/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.participants")),1)]),_:1},8,["to"])):c("",!0),t(),u(i).tabs.news?(s(),f(g,{key:4,to:u(i).url+"news/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.news")),1)]),_:1},8,["to"])):c("",!0),t(),u(i).tabs.place?(s(),f(g,{key:5,to:u(i).url+"place/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.place")),1)]),_:1},8,["to"])):c("",!0),t(),u(i).tabs.tour?(s(),f(g,{key:6,to:u(i).url+"tour/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.tour")),1)]),_:1},8,["to"])):c("",!0),t(),u(i).tabs.program?(s(),f(g,{key:7,to:u(i).url+"program/",class:"navigation-item"},{default:m(()=>[t(n(v.$t("events.tabs.program")),1)]),_:1},8,["to"])):c("",!0)]),t(),r("div",{class:S(["content-block-wrap",{"full-width-table":y.value&&$.value==="result","old-event-page":$.value==="result"}])},[b(R,{event:u(i),class:"content-block-main"},null,8,["event"]),t(),r("aside",kt,[b(nt,{event:u(i),toggle:$.value==="result",onToggle:j},null,8,["event","toggle"])])],2)])]),t(),b(ht,{items:u(p)},null,8,["items"])])}}};export{At as default};
